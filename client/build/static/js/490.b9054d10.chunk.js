"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[490],{208:(e,s,t)=>{t.d(s,{A:()=>n});const{defaultURL:a}=t(938),n=async e=>{const s=await fetch(a+"/leaderboard/current/"+e,{method:"GET",headers:{"Content-Type":"application/json"}});return await s.json()}},722:(e,s,t)=>{t.d(s,{J:()=>d,t:()=>o});var a=t(547);const n=t.p+"static/media/crystaux.6031ea774af93543fa7e.webp",r=t.p+"static/media/iscoin.3d3917b803cb880ac7b2.webp",c=t.p+"static/media/dragon_egg.46bf7bb95bf9561239d7.webp",l=t.p+"static/media/beacon.4493e6b9ee97a80325b2.webp",i=t.p+"static/media/sponge.c5d1b69c2e9e10cccf7c.webp",o={crystaux:{multiplier:100,label:"Crystaux",format:e=>"".concat((0,a.qy)(e)," = ").concat((0,a.$M)(100*e)," Crystaux"),requiredAmount:50,icon:n},iscoin:{multiplier:2e6,label:"IsCoin",format:e=>"".concat((0,a.qy)(e)," = ").concat((0,a.$M)(2e6*e)," $"),requiredAmount:1e3,icon:r}},d={dragonegg:{multiplier:15e8,label:"DragonEgg",format:e=>"".concat((0,a.qy)(e)," = ").concat((0,a.$M)(15e8*e)," $"),icon:c},beacon:{multiplier:15e7,label:"Beacon",format:e=>"".concat((0,a.qy)(e)," = ").concat((0,a.$M)(15e7*e)," $"),icon:l},sponge:{multiplier:15e6,label:"Sponge",format:e=>"".concat((0,a.qy)(e)," = ").concat((0,a.$M)(15e6*e)," $"),icon:i}}},996:(e,s,t)=>{t.r(s),t.d(s,{default:()=>p});var a=t(555),n=t(43),r=t(579);const c=e=>{let{types:s,items:t,onSelect:a}=e;const[c,l]=(0,n.useState)(!1),[i,o]=(0,n.useState)(null);return(0,r.jsxs)("div",{className:"dropdown",children:[(0,r.jsx)("button",{type:"button",className:"dropdown-toggle",onClick:()=>l(e=>!e),children:i?(0,r.jsxs)("div",{className:"dropdown-selected",children:[(0,r.jsx)("img",{src:i.icon,alt:i.label}),(0,r.jsx)("span",{children:i.label})]}):(0,r.jsx)("span",{children:"S\xe9lectionner un classement"})}),c&&(0,r.jsx)("ul",{className:"dropdown-menu",children:s.map((e,s)=>{const n=t[e]||{};return(0,r.jsxs)("li",{className:"dropdown-item",onClick:e=>{var s;e.preventDefault(),o(s=n),a(s.label.toLowerCase()),l(!1)},children:[(0,r.jsx)("img",{src:n.icon,alt:n.label}),(0,r.jsx)("span",{children:n.label})]},s)})})]})};var l=t(208);const{defaultURL:i}=t(938),o=async(e,s)=>{const t=await fetch("".concat(i,"/leaderboards/update/").concat(e.toLowerCase()),{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:"".concat(localStorage.getItem("token_type")," ").concat(localStorage.getItem("access_token"))},body:JSON.stringify(s)}),a=await t.json();if(!t.ok)throw new Error((null===a||void 0===a?void 0:a.error)||"Staff update failed");return a};var d=t(722),u=t(547);const m=["crystaux","iscoin","dragonegg","beacon","sponge"],h=(0,a.A)((0,a.A)({},d.t),d.J),f={selectedUserKey:"",username:"",userId:"",points:""},p=e=>{let{isLogged:s,isAdmin:t}=e;const i=s&&t,[d,p]=(0,n.useState)({}),[b,x]=(0,n.useState)(()=>m.reduce((e,s)=>(e[s]=(0,a.A)({},f),e),{})),[j,v]=(0,n.useState)(!1),[g,y]=(0,n.useState)(""),[N,A]=(0,n.useState)(null),[w,I]=(0,n.useState)("crystaux"),C=e=>{x(s=>(0,a.A)((0,a.A)({},s),{},{[e]:(0,a.A)({},f)}))},S=(e,s)=>{x(t=>(0,a.A)((0,a.A)({},t),{},{[e]:(0,a.A)((0,a.A)({},t[e]||(0,a.A)({},f)),s)}))},k=(0,n.useCallback)(()=>{v(!0),Promise.all(m.map(e=>(0,l.A)(e).then(s=>{if(null!==s&&void 0!==s&&s.error)throw new Error(s.error);return[e,s]}).catch(s=>(console.error("Failed to load leaderboard ".concat(e),s),[e,null])))).then(e=>{const s={};let t=!1;e.forEach(e=>{let[a,n]=e;n?s[a]=n:t=!0}),p(s),y(t?"Certaines donn\xe9es n'ont pas pu \xeatre charg\xe9es. R\xe9essayez.":"")}).catch(e=>{console.error("Failed to load staff leaderboards",e),y("Impossible de charger les classements pour le moment.")}).finally(()=>v(!1))},[]);(0,n.useEffect)(()=>{i?k():(p({}),y(""),v(!1))},[i,k]);const q=async(e,s)=>{const t=b[e]||(0,a.A)({},f),n=Number(t.points);if(!n||n<=0)y("Veuillez indiquer un nombre de points strictement positif.");else if(t.username||t.userId)try{A(e),y("");const r={delta:"add"===s?n:-n,username:t.username||void 0,userId:t.userId?String(t.userId):void 0},c=await o(e,r);if(null!==c&&void 0!==c&&c.error)throw new Error(c.error);p(s=>(0,a.A)((0,a.A)({},s),{},{[e]:(0,a.A)((0,a.A)({},s[e]||{}),c)})),C(e)}catch(r){console.error("Staff update failed",r),y((null===r||void 0===r?void 0:r.message)||"Impossible de mettre \xe0 jour le classement. R\xe9essayez.")}finally{A(null)}else y("Un nom d'utilisateur ou un identifiant Discord est requis pour continuer.")},$=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return Array.isArray(e)&&0!==e.length?e.map((e,s)=>(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{children:s+1}),(0,r.jsx)("td",{children:e.name||"Sans nom"}),(0,r.jsx)("td",{children:(0,u.qy)(e.score||0)}),(0,r.jsx)("td",{children:e.userId||"\u2014"})]},"".concat(e.userId||e.name||s,"-").concat(s))):(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:"4",className:"staff-empty",children:"Aucun joueur pour le moment."})})};return i?(0,r.jsx)("section",{className:"App",children:(0,r.jsxs)("div",{className:"staff-dashboard",children:[(0,r.jsxs)("div",{className:"staff-dashboard-header",children:[(0,r.jsx)(c,{types:m,items:h,onSelect:I}),(0,r.jsx)("button",{className:"staff-refresh",onClick:k,disabled:j||null!==N,children:"Recharger"})]}),g&&(0,r.jsx)("div",{className:"staff-error",children:g}),j?(0,r.jsx)("div",{className:"spinner-container",children:(0,r.jsx)("div",{className:"spinner","aria-hidden":"true"})}):(0,r.jsx)("div",{className:"staff-grid",children:(w?[w]:m).map(e=>{const s=h[e]||{},t=d[e]||{},n=t.users||[],c=b[e]||(0,a.A)({},f),l=N===e,i=t.start&&t.end;return(0,r.jsxs)("div",{className:"staff-card",children:[(0,r.jsxs)("div",{className:"staff-card-header",children:[(0,r.jsxs)("div",{className:"staff-card-title",children:[(0,r.jsx)("h3",{children:s.label||e}),s.icon&&(0,r.jsx)("img",{src:s.icon,alt:s.label||e,className:"staff-card-icon"})]}),i&&(0,r.jsxs)("span",{className:"staff-period",children:[(0,u.kz)(t.start)," -"," ",(0,u.kz)(t.end)]})]}),(0,r.jsx)("div",{className:"staff-table-wrapper",children:(0,r.jsxs)("table",{className:"staff-table",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{children:"#"}),(0,r.jsx)("th",{children:"Joueur"}),(0,r.jsx)("th",{children:"Points"}),(0,r.jsx)("th",{children:"Discord ID"})]})}),(0,r.jsx)("tbody",{children:$(n)})]})}),(0,r.jsxs)("div",{className:"staff-form",children:[(0,r.jsxs)("label",{children:["Joueur existant",(0,r.jsxs)("select",{value:c.selectedUserKey,onChange:s=>((e,s)=>{var t;if(!s)return void C(e);const a=(null===(t=d[e])||void 0===t?void 0:t.users)||[];let n=null;if(s.startsWith("id:")){const e=s.slice(3);n=a.find(s=>s.userId&&String(s.userId)===e)}else if(s.startsWith("idx:")){const e=Number(s.slice(4));!Number.isNaN(e)&&a[e]&&(n=a[e])}S(e,n?{selectedUserKey:s,username:n.name||"",userId:n.userId?String(n.userId):""}:{selectedUserKey:s})})(e,s.target.value),children:[(0,r.jsx)("option",{value:"",children:"-- Nouveau membre --"}),n.map((e,s)=>{const t=e.userId?"id:".concat(e.userId):"idx:".concat(s);return(0,r.jsxs)("option",{value:t,children:[e.name||"Sans nom"," (",(0,u.qy)(e.score||0)," pts)"]},t)})]})]}),(0,r.jsxs)("label",{children:["Nom d'affichage",(0,r.jsx)("input",{type:"text",placeholder:"Nom du joueur",value:c.username,onChange:s=>S(e,{username:s.target.value})})]}),(0,r.jsxs)("label",{children:["Discord ID (optionnel)",(0,r.jsx)("input",{type:"text",placeholder:"Identifiant num\xe9rique",value:c.userId,onChange:s=>S(e,{userId:s.target.value.trim()})})]}),(0,r.jsxs)("label",{children:["Points",(0,r.jsx)("input",{type:"number",min:"1",max:"1000000",value:c.points,onChange:s=>S(e,{points:s.target.value})})]}),(0,r.jsxs)("div",{className:"staff-form-actions",children:[(0,r.jsx)("button",{type:"button",className:"staff-button staff-button--add",disabled:l,onClick:()=>q(e,"add"),children:"Ajouter"}),(0,r.jsx)("button",{type:"button",className:"staff-button staff-button--remove",disabled:l,onClick:()=>q(e,"remove"),children:"Retirer"}),(0,r.jsx)("button",{type:"button",className:"staff-button staff-button--reset",disabled:l,onClick:()=>C(e),children:"Vider"})]})]})]},e)})})]})}):(0,r.jsx)("section",{className:"App",children:(0,r.jsx)("div",{className:"staff-dashboard staff-dashboard--center",children:(0,r.jsxs)("div",{className:"staff-card",children:[(0,r.jsx)("h3",{children:"Acc\xe8s refus\xe9"}),(0,r.jsx)("p",{children:"Ce tableau de bord est r\xe9serv\xe9 aux membres du staff habilit\xe9s."})]})})})}}}]);
//# sourceMappingURL=490.b9054d10.chunk.js.map