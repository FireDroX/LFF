"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[290],{556:(e,s,a)=>{a.r(s),a.d(s,{default:()=>h});var t=a(555),r=a(43),n=a(579);const l=e=>{let{types:s,items:a,onSelect:t}=e;const[l,c]=(0,r.useState)(!1),[i,d]=(0,r.useState)(null);return(0,n.jsxs)("div",{className:"dropdown",children:[(0,n.jsx)("button",{type:"button",className:"dropdown-toggle",onClick:()=>c(e=>!e),children:i?(0,n.jsxs)("div",{className:"dropdown-selected",children:[(0,n.jsx)("img",{src:i.icon,alt:i.label}),(0,n.jsx)("span",{children:i.label})]}):(0,n.jsx)("span",{children:"S\xe9lectionner un classement"})}),l&&(0,n.jsx)("ul",{className:"dropdown-menu",children:s.map((e,s)=>{const r=a[e]||{};return(0,n.jsxs)("li",{className:"dropdown-item",onClick:e=>{var s;e.preventDefault(),d(s=r),t(s.label.toLowerCase()),c(!1)},children:[(0,n.jsx)("img",{src:r.icon,alt:r.label}),(0,n.jsx)("span",{children:r.label})]},s)})})]})};var c=a(506),i=a(722),d=a(547);const o=["crystaux","iscoin","dragonegg","beacon","sponge"],u=(0,t.A)((0,t.A)({},i.t),i.J),m={selectedUserKey:"",username:"",userId:"",points:""},h=e=>{let{isLogged:s,isAdmin:a}=e;const i=s&&a,[h,f]=(0,r.useState)({}),[p,b]=(0,r.useState)(()=>o.reduce((e,s)=>(e[s]=(0,t.A)({},m),e),{})),[x,j]=(0,r.useState)(!1),[v,g]=(0,r.useState)(""),[N,y]=(0,r.useState)(null),[A,I]=(0,r.useState)("crystaux"),w=e=>{b(s=>(0,t.A)((0,t.A)({},s),{},{[e]:(0,t.A)({},m)}))},C=(e,s)=>{b(a=>(0,t.A)((0,t.A)({},a),{},{[e]:(0,t.A)((0,t.A)({},a[e]||(0,t.A)({},m)),s)}))},S=(0,r.useCallback)(()=>{j(!0),Promise.all(o.map(e=>(0,c.Zw)(e).then(s=>{if(null!==s&&void 0!==s&&s.error)throw new Error(s.error);return[e,s]}).catch(s=>(console.error("Failed to load leaderboard ".concat(e),s),[e,null])))).then(e=>{const s={};let a=!1;e.forEach(e=>{let[t,r]=e;r?s[t]=r:a=!0}),f(s),g(a?"Certaines donn\xe9es n'ont pas pu \xeatre charg\xe9es. R\xe9essayez.":"")}).catch(e=>{console.error("Failed to load staff leaderboards",e),g("Impossible de charger les classements pour le moment.")}).finally(()=>j(!1))},[]);(0,r.useEffect)(()=>{i?S():(f({}),g(""),j(!1))},[i,S]);const k=async(e,s)=>{const a=p[e]||(0,t.A)({},m),r=Number(a.points);if(!r||r<=0)g("Veuillez indiquer un nombre de points strictement positif.");else if(a.username||a.userId)try{y(e),g("");const n={delta:"add"===s?r:-r,username:a.username||void 0,userId:a.userId?String(a.userId):void 0},l=await(0,c.VJ)(e,n);if(null!==l&&void 0!==l&&l.error)throw new Error(l.error);f(s=>(0,t.A)((0,t.A)({},s),{},{[e]:(0,t.A)((0,t.A)({},s[e]||{}),l)})),w(e)}catch(n){console.error("Staff update failed",n),g((null===n||void 0===n?void 0:n.message)||"Impossible de mettre \xe0 jour le classement. R\xe9essayez.")}finally{y(null)}else g("Un nom d'utilisateur ou un identifiant Discord est requis pour continuer.")},q=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return Array.isArray(e)&&0!==e.length?e.map((e,s)=>(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:s+1}),(0,n.jsx)("td",{children:e.name||"Sans nom"}),(0,n.jsx)("td",{children:(0,d.qy)(e.score||0)}),(0,n.jsx)("td",{children:e.userId||"\u2014"})]},"".concat(e.userId||e.name||s,"-").concat(s))):(0,n.jsx)("tr",{children:(0,n.jsx)("td",{colSpan:"4",className:"staff-empty",children:"Aucun joueur pour le moment."})})};return i?(0,n.jsx)("section",{className:"App",children:(0,n.jsxs)("div",{className:"staff-dashboard",children:[(0,n.jsxs)("div",{className:"staff-dashboard-header",children:[(0,n.jsx)(l,{types:o,items:u,onSelect:I}),(0,n.jsx)("button",{className:"staff-refresh",onClick:S,disabled:x||null!==N,children:"Recharger"})]}),v&&(0,n.jsx)("div",{className:"staff-error",children:v}),x?(0,n.jsx)("div",{className:"spinner-container",children:(0,n.jsx)("div",{className:"spinner","aria-hidden":"true"})}):(0,n.jsx)("div",{className:"staff-grid",children:(A?[A]:o).map(e=>{const s=u[e]||{},a=h[e]||{},r=a.users||[],l=p[e]||(0,t.A)({},m),c=N===e,i=a.start&&a.end;return(0,n.jsxs)("div",{className:"staff-card",children:[(0,n.jsxs)("div",{className:"staff-card-header",children:[(0,n.jsxs)("div",{className:"staff-card-title",children:[(0,n.jsx)("h3",{children:s.label||e}),s.icon&&(0,n.jsx)("img",{src:s.icon,alt:s.label||e,className:"staff-card-icon"})]}),i&&(0,n.jsxs)("span",{className:"staff-period",children:[(0,d.kz)(a.start)," -"," ",(0,d.kz)(a.end)]})]}),(0,n.jsx)("div",{className:"staff-table-wrapper",children:(0,n.jsxs)("table",{className:"staff-table",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{children:"#"}),(0,n.jsx)("th",{children:"Joueur"}),(0,n.jsx)("th",{children:"Points"}),(0,n.jsx)("th",{children:"Discord ID"})]})}),(0,n.jsx)("tbody",{children:q(r)})]})}),(0,n.jsxs)("div",{className:"staff-form",children:[(0,n.jsxs)("label",{children:["Joueur existant",(0,n.jsxs)("select",{value:l.selectedUserKey,onChange:s=>((e,s)=>{var a;if(!s)return void w(e);const t=(null===(a=h[e])||void 0===a?void 0:a.users)||[];let r=null;if(s.startsWith("id:")){const e=s.slice(3);r=t.find(s=>s.userId&&String(s.userId)===e)}else if(s.startsWith("idx:")){const e=Number(s.slice(4));!Number.isNaN(e)&&t[e]&&(r=t[e])}C(e,r?{selectedUserKey:s,username:r.name||"",userId:r.userId?String(r.userId):""}:{selectedUserKey:s})})(e,s.target.value),children:[(0,n.jsx)("option",{value:"",children:"-- Nouveau membre --"}),r.map((e,s)=>{const a=e.userId?"id:".concat(e.userId):"idx:".concat(s);return(0,n.jsxs)("option",{value:a,children:[e.name||"Sans nom"," (",(0,d.qy)(e.score||0)," pts)"]},a)})]})]}),(0,n.jsxs)("label",{children:["Nom d'affichage",(0,n.jsx)("input",{type:"text",placeholder:"Nom du joueur",value:l.username,onChange:s=>C(e,{username:s.target.value})})]}),(0,n.jsxs)("label",{children:["Discord ID (optionnel)",(0,n.jsx)("input",{type:"text",placeholder:"Identifiant num\xe9rique",value:l.userId,onChange:s=>C(e,{userId:s.target.value.trim()})})]}),(0,n.jsxs)("label",{children:["Points",(0,n.jsx)("input",{type:"number",min:"1",max:"1000000",value:l.points,onChange:s=>C(e,{points:s.target.value})})]}),(0,n.jsxs)("div",{className:"staff-form-actions",children:[(0,n.jsx)("button",{type:"button",className:"staff-button staff-button--add",disabled:c,onClick:()=>k(e,"add"),children:"Ajouter"}),(0,n.jsx)("button",{type:"button",className:"staff-button staff-button--remove",disabled:c,onClick:()=>k(e,"remove"),children:"Retirer"}),(0,n.jsx)("button",{type:"button",className:"staff-button staff-button--reset",disabled:c,onClick:()=>w(e),children:"Vider"})]})]})]},e)})})]})}):(0,n.jsx)("section",{className:"App",children:(0,n.jsx)("div",{className:"staff-dashboard staff-dashboard--center",children:(0,n.jsxs)("div",{className:"staff-card",children:[(0,n.jsx)("h3",{children:"Acc\xe8s refus\xe9"}),(0,n.jsx)("p",{children:"Ce tableau de bord est r\xe9serv\xe9 aux membres du staff habilit\xe9s."})]})})})}},722:(e,s,a)=>{a.d(s,{J:()=>o,t:()=>d});var t=a(547);const r=a.p+"static/media/crystaux.6031ea774af93543fa7e.webp",n=a.p+"static/media/iscoin.3d3917b803cb880ac7b2.webp",l=a.p+"static/media/dragon_egg.46bf7bb95bf9561239d7.webp",c=a.p+"static/media/beacon.4493e6b9ee97a80325b2.webp",i=a.p+"static/media/sponge.c5d1b69c2e9e10cccf7c.webp",d={crystaux:{multiplier:100,label:"Crystaux",format:e=>"".concat((0,t.qy)(e)," = ").concat((0,t.$M)(100*e)," Crystaux"),requiredAmount:50,icon:r},iscoin:{multiplier:2e6,label:"IsCoin",format:e=>"".concat((0,t.qy)(e)," = ").concat((0,t.$M)(2e6*e)," $"),requiredAmount:1e3,icon:n}},o={dragonegg:{multiplier:15e8,label:"DragonEgg",format:e=>"".concat((0,t.qy)(e)," = ").concat((0,t.$M)(15e8*e)," $"),icon:l},beacon:{multiplier:15e7,label:"Beacon",format:e=>"".concat((0,t.qy)(e)," = ").concat((0,t.$M)(15e7*e)," $"),icon:c},sponge:{multiplier:15e6,label:"Sponge",format:e=>"".concat((0,t.qy)(e)," = ").concat((0,t.$M)(15e6*e)," $"),icon:i}}}}]);
//# sourceMappingURL=290.0bf5a1fe.chunk.js.map