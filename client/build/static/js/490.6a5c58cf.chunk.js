"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[490],{208:(e,s,t)=>{t.d(s,{A:()=>r});const{defaultURL:a}=t(938),r=async e=>{const s=await fetch(a+"/leaderboard/current/"+e,{method:"GET",headers:{"Content-Type":"application/json"}}),t=await s.json();if(!s.ok)throw new Error((null===t||void 0===t?void 0:t.error)||"Failed to fetch current top leaderboard");return t}},722:(e,s,t)=>{t.d(s,{J:()=>d,t:()=>i});var a=t(547);const r=t.p+"static/media/crystaux.6031ea774af93543fa7e.webp",n=t.p+"static/media/iscoin.3d3917b803cb880ac7b2.webp",l=t.p+"static/media/dragon_egg.46bf7bb95bf9561239d7.webp",c=t.p+"static/media/beacon.4493e6b9ee97a80325b2.webp",o=t.p+"static/media/sponge.c5d1b69c2e9e10cccf7c.webp",i={crystaux:{multiplier:100,label:"Crystaux",format:e=>"".concat((0,a.qy)(e)," = ").concat((0,a.$M)(100*e)," Crystaux"),requiredAmount:50,icon:r},iscoin:{multiplier:2e6,label:"IsCoin",format:e=>"".concat((0,a.qy)(e)," = ").concat((0,a.$M)(2e6*e)," $"),requiredAmount:1e3,icon:n}},d={dragonegg:{multiplier:15e8,label:"DragonEgg",format:e=>"".concat((0,a.qy)(e)," = ").concat((0,a.$M)(15e8*e)," $"),icon:l},beacon:{multiplier:15e7,label:"Beacon",format:e=>"".concat((0,a.qy)(e)," = ").concat((0,a.$M)(15e7*e)," $"),icon:c},sponge:{multiplier:15e6,label:"Sponge",format:e=>"".concat((0,a.qy)(e)," = ").concat((0,a.$M)(15e6*e)," $"),icon:o}}},996:(e,s,t)=>{t.r(s),t.d(s,{default:()=>p});var a=t(555),r=t(43),n=t(579);const l=e=>{let{types:s,items:t,onSelect:a}=e;const[l,c]=(0,r.useState)(!1),[o,i]=(0,r.useState)(null);return(0,n.jsxs)("div",{className:"dropdown",children:[(0,n.jsx)("button",{type:"button",className:"dropdown-toggle",onClick:()=>c(e=>!e),children:o?(0,n.jsxs)("div",{className:"dropdown-selected",children:[(0,n.jsx)("img",{src:o.icon,alt:o.label}),(0,n.jsx)("span",{children:o.label})]}):(0,n.jsx)("span",{children:"S\xe9lectionner un classement"})}),l&&(0,n.jsx)("ul",{className:"dropdown-menu",children:s.map((e,s)=>{const r=t[e]||{};return(0,n.jsxs)("li",{className:"dropdown-item",onClick:e=>{var s;e.preventDefault(),i(s=r),a(s.label.toLowerCase()),c(!1)},children:[(0,n.jsx)("img",{src:r.icon,alt:r.label}),(0,n.jsx)("span",{children:r.label})]},s)})})]})};var c=t(208);const{defaultURL:o}=t(938),i=async(e,s)=>{const t=await fetch("".concat(o,"/leaderboards/update/").concat(e.toLowerCase()),{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:"".concat(localStorage.getItem("token_type")," ").concat(localStorage.getItem("access_token"))},body:JSON.stringify(s)}),a=await t.json();if(!t.ok)throw new Error((null===a||void 0===a?void 0:a.error)||"Staff update failed");return a};var d=t(722),u=t(547);const m=["crystaux","iscoin","dragonegg","beacon","sponge"],h=(0,a.A)((0,a.A)({},d.t),d.J),f={selectedUserKey:"",username:"",userId:"",points:""},p=e=>{let{isLogged:s,isAdmin:t}=e;const o=s&&t,[d,p]=(0,r.useState)({}),[b,x]=(0,r.useState)(()=>m.reduce((e,s)=>(e[s]=(0,a.A)({},f),e),{})),[j,v]=(0,r.useState)(!1),[g,y]=(0,r.useState)(""),[N,A]=(0,r.useState)(null),[w,I]=(0,r.useState)("crystaux"),C=e=>{x(s=>(0,a.A)((0,a.A)({},s),{},{[e]:(0,a.A)({},f)}))},S=(e,s)=>{x(t=>(0,a.A)((0,a.A)({},t),{},{[e]:(0,a.A)((0,a.A)({},t[e]||(0,a.A)({},f)),s)}))},k=(0,r.useCallback)(()=>{v(!0),Promise.all(m.map(e=>(0,c.A)(e).then(s=>{if(null!==s&&void 0!==s&&s.error)throw new Error(s.error);return[e,s]}).catch(s=>(console.error("Failed to load leaderboard ".concat(e),s),[e,null])))).then(e=>{const s={};let t=!1;e.forEach(e=>{let[a,r]=e;r?s[a]=r:t=!0}),p(s),y(t?"Certaines donn\xe9es n'ont pas pu \xeatre charg\xe9es. R\xe9essayez.":"")}).catch(e=>{console.error("Failed to load staff leaderboards",e),y("Impossible de charger les classements pour le moment.")}).finally(()=>v(!1))},[]);(0,r.useEffect)(()=>{o?k():(p({}),y(""),v(!1))},[o,k]);const q=async(e,s)=>{const t=b[e]||(0,a.A)({},f),r=Number(t.points);if(!r||r<=0)y("Veuillez indiquer un nombre de points strictement positif.");else if(t.username||t.userId)try{A(e),y("");const n={delta:"add"===s?r:-r,username:t.username||void 0,userId:t.userId?String(t.userId):void 0},l=await i(e,n);if(null!==l&&void 0!==l&&l.error)throw new Error(l.error);p(s=>(0,a.A)((0,a.A)({},s),{},{[e]:(0,a.A)((0,a.A)({},s[e]||{}),l)})),C(e)}catch(n){console.error("Staff update failed",n),y((null===n||void 0===n?void 0:n.message)||"Impossible de mettre \xe0 jour le classement. R\xe9essayez.")}finally{A(null)}else y("Un nom d'utilisateur ou un identifiant Discord est requis pour continuer.")},$=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return Array.isArray(e)&&0!==e.length?e.map((e,s)=>(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:s+1}),(0,n.jsx)("td",{children:e.name||"Sans nom"}),(0,n.jsx)("td",{children:(0,u.qy)(e.score||0)}),(0,n.jsx)("td",{children:e.userId||"\u2014"})]},"".concat(e.userId||e.name||s,"-").concat(s))):(0,n.jsx)("tr",{children:(0,n.jsx)("td",{colSpan:"4",className:"staff-empty",children:"Aucun joueur pour le moment."})})};return o?(0,n.jsx)("section",{className:"App",children:(0,n.jsxs)("div",{className:"staff-dashboard",children:[(0,n.jsxs)("div",{className:"staff-dashboard-header",children:[(0,n.jsx)(l,{types:m,items:h,onSelect:I}),(0,n.jsx)("button",{className:"staff-refresh",onClick:k,disabled:j||null!==N,children:"Recharger"})]}),g&&(0,n.jsx)("div",{className:"staff-error",children:g}),j?(0,n.jsx)("div",{className:"spinner-container",children:(0,n.jsx)("div",{className:"spinner","aria-hidden":"true"})}):(0,n.jsx)("div",{className:"staff-grid",children:(w?[w]:m).map(e=>{const s=h[e]||{},t=d[e]||{},r=t.users||[],l=b[e]||(0,a.A)({},f),c=N===e,o=t.start&&t.end;return(0,n.jsxs)("div",{className:"staff-card",children:[(0,n.jsxs)("div",{className:"staff-card-header",children:[(0,n.jsxs)("div",{className:"staff-card-title",children:[(0,n.jsx)("h3",{children:s.label||e}),s.icon&&(0,n.jsx)("img",{src:s.icon,alt:s.label||e,className:"staff-card-icon"})]}),o&&(0,n.jsxs)("span",{className:"staff-period",children:[(0,u.kz)(t.start)," -"," ",(0,u.kz)(t.end)]})]}),(0,n.jsx)("div",{className:"staff-table-wrapper",children:(0,n.jsxs)("table",{className:"staff-table",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{children:"#"}),(0,n.jsx)("th",{children:"Joueur"}),(0,n.jsx)("th",{children:"Points"}),(0,n.jsx)("th",{children:"Discord ID"})]})}),(0,n.jsx)("tbody",{children:$(r)})]})}),(0,n.jsxs)("div",{className:"staff-form",children:[(0,n.jsxs)("label",{children:["Joueur existant",(0,n.jsxs)("select",{value:l.selectedUserKey,onChange:s=>((e,s)=>{var t;if(!s)return void C(e);const a=(null===(t=d[e])||void 0===t?void 0:t.users)||[];let r=null;if(s.startsWith("id:")){const e=s.slice(3);r=a.find(s=>s.userId&&String(s.userId)===e)}else if(s.startsWith("idx:")){const e=Number(s.slice(4));!Number.isNaN(e)&&a[e]&&(r=a[e])}S(e,r?{selectedUserKey:s,username:r.name||"",userId:r.userId?String(r.userId):""}:{selectedUserKey:s})})(e,s.target.value),children:[(0,n.jsx)("option",{value:"",children:"-- Nouveau membre --"}),r.map((e,s)=>{const t=e.userId?"id:".concat(e.userId):"idx:".concat(s);return(0,n.jsxs)("option",{value:t,children:[e.name||"Sans nom"," (",(0,u.qy)(e.score||0)," pts)"]},t)})]})]}),(0,n.jsxs)("label",{children:["Nom d'affichage",(0,n.jsx)("input",{type:"text",placeholder:"Nom du joueur",value:l.username,onChange:s=>S(e,{username:s.target.value})})]}),(0,n.jsxs)("label",{children:["Discord ID (optionnel)",(0,n.jsx)("input",{type:"text",placeholder:"Identifiant num\xe9rique",value:l.userId,onChange:s=>S(e,{userId:s.target.value.trim()})})]}),(0,n.jsxs)("label",{children:["Points",(0,n.jsx)("input",{type:"number",min:"1",max:"1000000",value:l.points,onChange:s=>S(e,{points:s.target.value})})]}),(0,n.jsxs)("div",{className:"staff-form-actions",children:[(0,n.jsx)("button",{type:"button",className:"staff-button staff-button--add",disabled:c,onClick:()=>q(e,"add"),children:"Ajouter"}),(0,n.jsx)("button",{type:"button",className:"staff-button staff-button--remove",disabled:c,onClick:()=>q(e,"remove"),children:"Retirer"}),(0,n.jsx)("button",{type:"button",className:"staff-button staff-button--reset",disabled:c,onClick:()=>C(e),children:"Vider"})]})]})]},e)})})]})}):(0,n.jsx)("section",{className:"App",children:(0,n.jsx)("div",{className:"staff-dashboard staff-dashboard--center",children:(0,n.jsxs)("div",{className:"staff-card",children:[(0,n.jsx)("h3",{children:"Acc\xe8s refus\xe9"}),(0,n.jsx)("p",{children:"Ce tableau de bord est r\xe9serv\xe9 aux membres du staff habilit\xe9s."})]})})})}}}]);
//# sourceMappingURL=490.6a5c58cf.chunk.js.map